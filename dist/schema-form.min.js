var deps=["ObjectPath"];try{angular.module("ngSanitize"),deps.push("ngSanitize")}catch(e){}try{angular.module("ui.sortable"),deps.push("ui.sortable")}catch(e){}try{angular.module("angularSpectrumColorpicker"),deps.push("angularSpectrumColorpicker")}catch(e){}try{angular.module("ui.bootstrap"),deps.push("ui.bootstrap")}catch(e){}angular.module("schemaForm",deps),angular.module("schemaForm").provider("sfPath",["ObjectPathProvider",function(e){var r={parse:e.parse};r.stringify=1===angular.version.major&&angular.version.minor<3?function(e){return Array.isArray(e)?e.join("."):e.toString()}:e.stringify,r.normalize=function(e,n){return r.stringify(Array.isArray(e)?e:r.parse(e),n)},this.parse=r.parse,this.stringify=r.stringify,this.normalize=r.normalize,this.$get=function(){return r}}]),angular.module("schemaForm").factory("sfSelect",["sfPath",function(e){var r=/^\d+$/;return function(n,t,i){t||(t=this);var a="string"==typeof n?e.parse(n):n;if("undefined"!=typeof i&&1===a.length)return t[a[0]]=i,t;"undefined"!=typeof i&&"undefined"==typeof t[a[0]]&&(t[a[0]]=a.length>2&&r.test(a[1])?[]:{});for(var o=t[a[0]],l=1;l<a.length;l++){if(""===a[l])return void 0;if("undefined"!=typeof i){if(l===a.length-1)return o[a[l]]=i,i;var u=o[a[l]];("undefined"==typeof u||null===u)&&(u=r.test(a[l+1])?[]:{},o[a[l]]=u),o=u}else o&&(o=o[a[l]])}return o}}]),angular.module("schemaForm").provider("schemaFormDecorators",["$compileProvider","sfPathProvider",function(e,r){var n="",t={},i=function(e,r){"sfDecorator"===e&&(e=n);for(var i=t[e],a=i.rules,o=0;o<a.length;o++){var l=a[o](r);if(l)return l}return i.mappings[r.type]?i.mappings[r.type]:i.mappings["default"]},a=function(e){"hidden"===e.type&&e.key&&/^_/.test(e.key)&&(e.schema={type:"string",required:!0})},o=function(n){e.directive(n,["$parse","$compile","$http","$templateCache","scrollingTop","$timeout",function(e,t,o,l,u,s){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"?^sfSchema",link:function(c,f,d,m){var p=c.defaultGlobals||c.$eval(d.defaultGlobals),h=function(e,r,n){var t="",i="";return e.schema&&(e.schema.visibility?t="."+e.schema.visibility:r.visibility&&(t="."+r.visibility),e.schema.category?i="."+e.schema.category:r.category&&(i="."+r.category)),"model"+t+i+("["!==n[0]?".":"")+n},g=c.$watch(d.form,function(e){if(e){a(e),c.form=e,c.defaultGlobals=p;var u=i(n,e);o.get(u,{cache:l}).then(function(n){var i=e.key?r.stringify(e.key).replace(/"/g,"&quot;"):"";c.keyModelName=h(e,c.defaultGlobals,i);var a=n.data.replace(/\$\$value\$\$/g,c.keyModelName);f.html(a),t(f.contents())(c)}),g()}});c.showTitle=function(){return c.form&&c.form.notitle!==!0&&c.form.title},c.listToCheckboxValues=function(e){var r={};return angular.forEach(e,function(e){r[e]=!0}),r},c.checkboxValuesToList=function(e){var r=[];return angular.forEach(e,function(e,n){e&&r.push(n)}),r},c.buttonClick=function(e,r){angular.isFunction(r.onClick)?r.onClick(e,r):angular.isString(r.onClick)&&(m?m.evalInParentScope(r.onClick,{$event:e,form:r}):c.$eval(r.onClick,{$event:e,form:r}))},c.finishIt=function(e,r){angular.isFunction(r.finishIt)?finishIt.onClick(e,r):angular.isString(r.finishIt)&&(m?m.evalInParentScope(r.finishIt,{$event:e,form:r}):c.$eval(r.finishIt,{$event:e,form:r}))};var v=function(e,r){var n;return angular.isUndefined(e)?n:($.each(e,function(e,t){angular.isObject(t)?$.each(t,function(e,t){angular.isObject(t)?$.each(t,function(e,t){e===r&&(n=t)}):e===r&&(n=t)}):e===r&&(n=t)}),n)};c.showCondition=function(){var r=!0,n=function(){return angular.isDefined(c.form.conditionalHiddenValue)&&v(c.model,c.form.conditionalHiddenKey)===c.form.conditionalHiddenValue},t=function(){return angular.isDefined(c.form.secondConditionalHiddenValue)&&v(c.model,c.form.secondConditionalHiddenKey)===c.form.secondConditionalHiddenValue},i=function(){var e=angular.isDefined(c.form.conditionalValue)&&v(c.model,c.form.conditionalKey)===c.form.conditionalValue;return c.form&&angular.isDefined(c.form.secondConditionalKey)&&(e=e&&v(c.model,c.form.secondConditionalKey)===c.form.secondConditionalValue),e};if(angular.isUndefined(c.form.conditionalValue)&&angular.isUndefined(c.form.conditionalHiddenValue))return!0;if(r=angular.isUndefined(c.form.conditionalValue)?r&&!n():angular.isUndefined(c.form.conditionalHiddenValue)?r&&i():r&&i()&&!n(),angular.isDefined(c.form.required)&&(c.form.required=r,c.form.schema.required=r),c.form.key&&!r){var a=e(c.keyModelName);n()&&!t()&&angular.isDefined(c.form.setHiddenValue)?a.assign(c,c.form.setHiddenValue):a.assign(c,void 0),f.find("input").val(""),c.ngModelHolder.$setPristine()}return r},c.clickCheckbox=function(r){var n=angular.element(r.currentTarget).find("input"),t=!!n.attr("checked");s(function(){n.attr("checked",!t);var r=e(c.keyModelName);r.assign(c,!t),c.$apply()},0)},c.disabledElement=function(){var e=c.form&&angular.isDefined(c.form.conditionalDisabledValue)&&v(c.model,c.form.conditionalDisabledKey)===c.form.conditionalDisabledValue;return c.form.required=!e,c.form.schema.required=!e,e&&(c.ngModelHolder.$setViewValue(void 0),f.find("input").val("")),c.form.disabled||e};var y=function(e){e=e||v(c.model,c.form.undefinedConditionKey);var r=moment(),n=c.form.minMonthlyDifference||0,t=c.form.maxMonthlyDifference,i=c.form.additionalMonthlyDifference,a=c.form.additionalDailyDifference,o=moment(e);return r.milliseconds(0),r.second(0),r.minute(0),r.hours(0),e&&t&&i&&(o.toDate().getTime()<moment(r).add(n,"Month").toDate().getTime()||o.toDate().getTime()>moment(r).add(t,"Month").toDate().getTime())&&(o=r.add(i,"Month").add(a,"Day")),o};c.hideWhenUndefined=function(){var e=angular.isDefined(c.form.undefinedConditionKey)&&angular.isUndefined(v(c.model,c.form.undefinedConditionKey));return e},c.setDateWatcher=function(){if(c.form.key){var r=function(){return v(c.model,c.form.undefinedConditionKey)};c.$watch(r,function(r){if(r){var n=e(c.keyModelName),t=y(r);n.assign(c,t.toDate().toISOString())}})}},c.getInfoDate=function(){var e=y();return moment.locale(c.form.encoding),moment(e).format(c.form.format)},c.conditionalValidationSuccess=function(){return angular.isDefined(c.form.conditionalValidationValue)&&v(c.model,c.form.conditionalValidationKey)===c.form.conditionalValidationValue},c.evalExpr=function(e,r){return m?m.evalInParentScope(e,r):c.$eval(e,r)},c.evalInScope=function(e,r){return e?c.$eval(e,r):void 0},c.errorMessage=function(e){return c.form.validationMessage?e?angular.isString(c.form.validationMessage)?c.form.validationMessage:c.form.validationMessage[e.code]||c.form.validationMessage["default"]:c.form.validationMessage.required||c.form.validationMessage["default"]||c.form.validationMessage:e?e.message:"Required"},c.nextStep=function(e){this.$broadcast("schemaFormValidate",this),this.formCtrl.$valid?(c.completed[e]=!0,c.selected.step=e+1,u.scrollTop()):u.scrollToTheFirstError(f,c.selected.step)},c.prevStep=function(e){c.selected.step=e-1,u.scrollTop()}}}}])},l=function(r,n,t){t=angular.isDefined(t)?t:!1,e.directive("sf"+angular.uppercase(r[0])+r.substr(1),function(){return{restrict:"EAC",scope:!0,replace:!0,transclude:t,template:'<sf-decorator form="form"></sf-decorator>',link:function(e,n,t){var i={items:"c",titleMap:"c",schema:"c"},a={type:r},o=!0;angular.forEach(t,function(r,n){if("$"!==n[0]&&0!==n.indexOf("ng")&&"sfField"!==n){var l=function(r){angular.isDefined(r)&&r!==a[n]&&(a[n]=r,o&&a.type&&(a.key||angular.isUndefined(t.key))&&(e.form=a,o=!1))};"model"===n?e.$watch(r,function(r){r&&e.model!==r&&(e.model=r)}):"c"===i[n]?e.$watchCollection(r,l):t.$observe(n,l)}})}}})};this.createDecorator=function(e,r,i){t[e]={mappings:r||{},rules:i||[]},t[n]||(n=e),o(e)},this.createDirective=l,this.createDirectives=function(e){angular.forEach(e,function(e,r){l(r,e)})},this.directive=function(e){return e=e||n,t[e]},this.addMapping=function(e,r,n){t[e]&&(t[e].mappings[r]=n)},this.$get=function(){return{directive:function(e){return t[e]},defaultDecorator:n}},o("sfDecorator")}]),angular.module("schemaForm").provider("schemaForm",["sfPathProvider",function(e){var r=function(e){var r=[];return e.forEach(function(e){r.push({name:e,value:e,id:"id_"+100*Math.random()})}),r},n=function(e){if(angular.isArray(e))return angular.forEach(e,function(e){e.id||(e.id="id_"+100*Math.random())}),e;var r=[];return angular.forEach(e,function(e,n){r.push({name:e,value:n,id:"id_"+100*Math.random()})}),r},t=function(e,r,n){var t=m[r.type];if(t)for(var i,a=0;a<t.length;a++)if(i=t[a](e,r,n))return i},i=function(e,r,t){t=t||{};var i=t.global&&t.global.formDefaults?angular.copy(t.global.formDefaults):{};return i.title=t.global&&t.global.supressPropertyTitles===!0?r.title:r.title||e,r.description&&(i.description=r.description),(t.required===!0||r.required===!0)&&(i.required=!0),r.maxLength&&(i.maxlength=r.maxLength),r.minLength&&(i.minlength=r.minLength),(r.readOnly||r.readonly)&&(i.readonly=!0),r.minimum&&(i.minimum=r.minimum+(r.exclusiveMinimum?1:0)),r.maximum&&(i.maximum=r.maximum-(r.exclusiveMaximum?1:0)),r.validationMessage&&(i.validationMessage=r.validationMessage),r.enumNames&&(i.titleMap=n(r.enumNames)),i.schema=r,i.ngModelOptions=i.ngModelOptions||{},i},a=function(r,n,t){if("string"===n.type&&!n.enum){var a=i(r,n,t);return a.key=t.path,a.type="text",t.lookup[e.stringify(t.path)]=a,a}},o=function(r,n,t){if("number"===n.type){var a=i(r,n,t);return a.key=t.path,a.type="number",t.lookup[e.stringify(t.path)]=a,a}},l=function(r,n,t){if("integer"===n.type){var a=i(r,n,t);return a.key=t.path,a.type="number",t.lookup[e.stringify(t.path)]=a,a}},u=function(r,n,t){if("boolean"===n.type){var a=i(r,n,t);return a.key=t.path,a.type="checkbox",t.lookup[e.stringify(t.path)]=a,a}},s=function(n,t,a){if("string"===t.type&&t.enum){var o=i(n,t,a);return o.key=a.path,o.type="select",o.titleMap||(o.titleMap=r(t.enum)),a.lookup[e.stringify(a.path)]=o,o}},c=function(n,t,a){if("array"===t.type&&t.items&&t.items.enum){var o=i(n,t,a);return o.key=a.path,o.type="checkboxes",o.titleMap||(o.titleMap=r(t.items.enum)),a.lookup[e.stringify(a.path)]=o,o}},f=function(r,n,a){if("object"===n.type){var o=i(r,n,a);return o.type="fieldset",o.items=[],a.lookup[e.stringify(a.path)]=o,angular.forEach(n.properties,function(r,i){var l=a.path.slice();if(l.push(i),a.ignore[e.stringify(l)]!==!0){var u=n.required&&-1!==n.required.indexOf(i),s=t(i,r,{path:l,required:u||!1,lookup:a.lookup,ignore:a.ignore});s&&o.items.push(s)}}),o}},d=function(r,n,a){if("array"===n.type){var o=i(r,n,a);o.type="array",o.key=a.path,a.lookup[e.stringify(a.path)]=o;var l=n.required,u=a.path.slice();return u.push(""),o.items=[t(r,n.items,{path:u,required:l||!1,lookup:a.lookup,ignore:a.ignore})],o}},m={string:[s,a],object:[f],number:[o],integer:[l],"boolean":[u],array:[c,d]},p=function(e){return e};this.defaults=m,this.stdFormObj=i,this.postProcess=function(e){p=e},this.appendRule=function(e,r){m[e]||(m[e]=[]),m[e].push(r)},this.prependRule=function(e,r){m[e]||(m[e]=[]),m[e].unshift(r)},this.createStandardForm=i,this.$get=function(){var r={};return r.merge=function(t,i,a,o){i=i||["*"],o=o||{};var l=r.defaults(t,a,o),u=i.indexOf("*");if(-1!==u)return i=i.slice(0,u).concat(l.form).concat(i.slice(u+1));var s=l.lookup;return p(i.map(function(i){if("string"==typeof i&&(i={key:i}),i.titleMap&&(i.titleMap=n(i.titleMap)),i.items&&(i.items=r.merge(t,i.items,a)),i.tabs&&angular.forEach(i.tabs,function(e){e.items=r.merge(t,e.items,a)}),i.steps&&angular.forEach(i.steps,function(e){e.items=r.merge(t,e.items,a)}),i.key){"string"==typeof i.key&&(i.key=e.parse(i.key));var o=e.stringify(i.key);s[o]&&(i=angular.extend(s[o],i))}return i}))},r.defaults=function(e,r,n){var i=[],a={};if(r=r||{},n=n||{},"object"!==e.type)throw new Error('Not implemented. Only type "object" allowed at root level of schema.');return angular.forEach(e.properties,function(o,l){if(r[l]!==!0){var u=e.required&&-1!==e.required.indexOf(l[l.length-1]),s=t(l,o,{path:[l],lookup:a,ignore:r,required:u,global:n});s&&i.push(s)}}),{form:i,lookup:a}},r.traverseSchema=function(e,r,n,t){t=angular.isDefined(t)?t:!0,n=n||[];var i=function(e,r,n){if(r(e,n),angular.forEach(e.properties,function(e,t){var a=n.slice();a.push(t),i(e,r,a)}),!t&&e.items){var a=n.slice();a.push(""),i(e.items,r,a)}};i(e,r,n||[])},r.traverseForm=function(e,n){n(e),angular.forEach(e.items,function(e){r.traverseForm(e,n)}),e.tabs&&angular.forEach(e.tabs,function(e){angular.forEach(e.items,function(e){r.traverseForm(e,n)})}),e.steps&&angular.forEach(e.steps,function(e){angular.forEach(e.items,function(e){r.traverseForm(e,n)})})},r}}]),angular.module("schemaForm").factory("scrollingTop",["$timeout",function(e){var r=function(r,n){e(function(){jQuery("html, body").animate({scrollTop:jQuery(r[0]).find("[index="+n+"] .has-error:first").offset().top},1e3)},0)},n=function(){e(function(){jQuery("html, body").animate({scrollTop:0},1e3)},0)};return{scrollToTheFirstError:r,scrollTop:n}}]),angular.module("schemaForm").factory("sfValidator",[function(){var e={};return tv4.addFormat({ssn:function(e){var r,n=[3,7,6,1,8,9,4,5,2,1,0],t=[5,4,3,2,7,6,5,4,3,2,1],i=0,a=0,o=0;if("string"!=typeof e)return"ssn should be a string!";for(r=e.split("");o<n.length;o+=1)i+=r[o]*n[o],a+=r[o]*t[o];return i%11==0&&a%11==0?null:"incorrect ssn"},email:function(e){return"string"==typeof e?/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/i.test(e)?null:"invalid email":"email should be a string!"},"date-format":function(e){return"string"==typeof e?Date.parse(e)?null:"invalid email":"date should be ISO string!"}}),e.validate=function(e,r){var n=e.schema;if(!n)return r;"integer"===n.type?r=parseInt(r,10):"number"===n.type?r=parseFloat(r,10):"boolean"===n.type&&"string"==typeof r&&("true"===r?r=!0:"false"===r&&(r=!1));var t={type:"object",properties:{}},i=e.key[e.key.length-1];t.properties[i]=n,n.required&&(t.required=[i]);var a={};return angular.isDefined(r)&&(a[i]=r),tv4.validateResult(a,t)},e}]),angular.module("schemaForm").directive("sfArray",["sfSelect","schemaForm","sfValidator",function(e,r,n){var t=function(e){return function(r){r.key&&(r.key[r.key.indexOf("")]=e)}};return{restrict:"A",scope:!0,require:"?ngModel",link:function(i,a,o,l){var u={},s=i.$watch(o.sfArray,function(a){var o=e(a.key,i.model);if(angular.isUndefined(o)&&(o=[],e(a.key,i.model,o)),i.modelArray=o,a.items){var c=a.items[0];a.items.length>1&&(c={type:"section",items:a.items})}if(i.copyWithIndex=function(e){if(!u[e]&&c){var n=angular.copy(c);n.arrayIndex=e,r.traverseForm(n,t(e)),u[e]=n}return u[e]},i.appendToArray=function(){var n=o.length,t=i.copyWithIndex(n);if(r.traverseForm(t,function(r){r.key&&angular.isDefined(r.default)&&e(r.key,i.model,r.default)}),n===o.length){var l,u=e("schema.items.type",a);"object"===u?l={}:"array"===u&&(l=[]),o.push(l)}return i.validateArray&&i.validateArray(),o},i.deleteFromArray=function(e){o.splice(e,1),i.validateArray&&i.validateArray()},a.titleMap||a.startEmpty===!0||0!==o.length||i.appendToArray(),a.titleMap&&a.titleMap.length>0){i.titleMapValues=[];var f=function(e){i.titleMapValues=[],e=e||[],a.titleMap.forEach(function(r){i.titleMapValues.push(-1!==e.indexOf(r.value))})};f(i.modelArray),i.$watchCollection("modelArray",f),i.$watchCollection("titleMapValues",function(e){if(e){for(var r=i.modelArray;r.length>0;)r.shift();a.titleMap.forEach(function(n,t){e[t]&&r.push(n.value)})}})}if(l){var d;i.validateArray=function(){var e=n.validate(a,i.modelArray.length>0?i.modelArray:void 0);e.valid!==!1||!e.error||""!==e.error.dataPath&&e.error.dataPath!=="/"+a.key[a.key.length-1]?l.$setValidity("schema",!0):(l.$setViewValue(i.modelArray),d=e.error,l.$setValidity("schema",!1))},i.$on("schemaFormValidate",i.validateArray),i.hasSuccess=function(){return l.$valid&&!l.$pristine},i.hasError=function(){return l.$invalid},i.schemaError=function(){return d}}s()})}}}]),angular.module("schemaForm").directive("sfChanged",function(){return{require:"ngModel",restrict:"AC",scope:!1,link:function(e,r,n,t){var i=e.$eval(n.sfChanged);i&&i.onChange&&t.$viewChangeListeners.push(function(){angular.isFunction(i.onChange)?i.onChange(t.$modelValue,i):e.evalExpr(i.onChange,{modelValue:t.$modelValue,form:i})})}}}),angular.module("schemaForm").directive("infoHelpMessage",[function(){return{restrict:"AE",templateUrl:"directives/decorators/stb-webmanual/info-message.html",scope:{infoMessage:"="},link:function(){}}}]),angular.module("schemaForm").directive("ngModelOnblur",function(){return{restrict:"A",require:"ngModel",priority:1,link:function(e,r,n,t){if("radio"!==n.type&&"checkbox"!==n.type){r.unbind("input").unbind("keydown").unbind("change"),r.bind("blur",function(){e.$apply(function(){""===r.val()&&t.$pristine||t.$setViewValue(r.val())})});var i=e.$eval(n.modelMaxLength);angular.isDefined(i)&&r.bind("keydown",function(e){var n=e.which,t=32>n||n>34&&41>n||46===n;return t?!0:void(r.val().length>=i&&e.preventDefault())})}}}}),angular.module("schemaForm").directive("sfSchema",["$compile","schemaForm","schemaFormDecorators","sfSelect",function(e,r,n,t){var i=/[A-Z]/g,a=function(e,r){return r=r||"_",e.replace(i,function(e,n){return(n?r:"")+e.toLowerCase()})};return{scope:{schema:"=sfSchema",initialForm:"=sfForm",model:"=sfModel"},controller:["$scope",function(e){this.evalInParentScope=function(r,n){return e.$parent.$eval(r,n)}}],replace:!1,restrict:"A",transclude:!0,require:"?form",link:function(i,o,l,u,s){i.formCtrl=u,i.defaultGlobals=i.$eval(l.defaultGlobals)||{visibility:"",category:""};var c={};s(i,function(e){if(e.addClass("schema-form-ignore"),o.prepend(e),o[0].querySelectorAll){var r=o[0].querySelectorAll("[ng-model]");if(r)for(var n=0;n<r.length;n++){var t=r[n].getAttribute("ng-model");c[t.substring(t.indexOf(".")+1)]=!0}}});var f={};i.$watch(function(){var u=i.schema,s=i.initialForm||["*"];if(s&&u&&u.type&&(f.form!==s||f.schema!==u)&&Object.keys(u.properties).length>0){f.schema=u,f.form=s;var d=i.$eval(l.sfOptions),m=r.merge(u,s,c,d),p=document.createDocumentFragment();i.schemaForm={form:m,schema:u},angular.forEach(m,function(e,r){var t=document.createElement(l.sfDecoratorName||a(n.defaultDecorator,"-"));t.setAttribute("form","schemaForm.form["+r+"]"),t.setAttribute("default-globals","defaultGlobals"),p.appendChild(t)}),o.children(":not(.schema-form-ignore)").remove(),o[0].appendChild(p),e(o.children())(i),r.traverseSchema(u,function(e,r){if(angular.isDefined(e["default"])){var n=t(r,i.model);angular.isUndefined(n)&&t(r,i.model,e["default"])}})}})}}}]),angular.module("schemaForm").directive("schemaValidate",["sfValidator",function(e){return{restrict:"A",scope:!1,require:"ngModel",link:function(r,n,t,i){var a=null;"radio"===t.type&&(r=r.$parent),r.ngModelHolder||(r.ngModelHolder=i);var a=null,o=r.$eval(t.schemaValidate),l=function(n){if(o||(o=r.$eval(t.schemaValidate)),!o)return n;if(angular.isDefined(t.ngRequired)&&angular.isUndefined(n))return void 0;""===n&&(n=void 0);var i=e.validate(o,n);return i.valid?(r.ngModelHolder.$setValidity("schema",!0),n):(r.ngModelHolder.$setValidity("schema",!1),void(a=i.error))};i.$parsers.unshift(l),r.$on("schemaFormValidate",function(){r.ngModelHolder.$commitViewValue?r.ngModelHolder.$commitViewValue(!0):r.ngModelHolder.$setViewValue(r.ngModelHolder.$viewValue)}),r.hasSuccess=function(){return r.ngModelHolder.$valid&&(!r.ngModelHolder.$pristine||!r.ngModelHolder.$isEmpty(r.ngModelHolder.$modelValue))},r.hasError=function(){return r.ngModelHolder.$invalid&&!r.ngModelHolder.$pristine},r.schemaError=function(){return a}}}}]);